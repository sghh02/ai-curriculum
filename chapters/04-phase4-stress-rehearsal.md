# PHASE 4：仕様変更に耐える設計へ再構築する

## この章の目的

実務では仕様変更が前提です。  
設計を壊されても、どこを差し替えれば再稼働できるかを即座に判断できる状態を作ります。

## AIの役割

このフェーズでのAIは**クレーマー / クライアント**です。  
理不尽な変更要求を出し続ける役として使います。

## 実施ステップ

1. 既存 `design-spec.md` の機能をモジュール単位に分割する
2. 変更シナリオを最低3つ作る
3. 各シナリオで「影響範囲」と「差し替え箇所」を特定する
4. 変更後のフローと条件分岐を再定義する
5. 変更前後の差分を `design-change-log.md` に記録する
6. AIに「変更後レビュー」を依頼し、副作用を洗い出す

## 推奨変更シナリオ

1. 会社方針で会議録音が禁止された
2. 個人情報保護で外部AIへの音声送信が不可になった
3. 承認フローが追加され、通知前に部長確認が必須になった

## 成果物更新

`design-spec.md` に以下を追加します。

- モジュール分解（差し替え単位）
- 変更後フロー
- 変更後条件分岐
- 副作用と対策

`design-change-log.md` に以下を追加します。

- 変更要求
- 影響範囲
- 差し替え内容
- 再検証結果

## AIに聞く例

```text
次の仕様変更が来た想定で、どのモジュールを差し替えるべきか教えて。
変更範囲が最小になる案を優先して提案して。
```

```text
変更後の設計で発生しそうな副作用を7つ挙げて。
各副作用に検証方法を1つずつ付けて。
```

## 評価ルーブリック（3軸）

| 観点 | 1: 不十分 | 2: 最低限 | 3: 実務レベル | 4: 高水準 |
|---|---|---|---|---|
| 問いの回数と質 | 変更を受け身で処理 | 影響を一部確認 | 影響範囲を体系化 | 副作用まで事前検証 |
| 言語化の粒度 | 差分が不明瞭 | 変更点のみ記載 | 差し替え箇所が明確 | 前後比較で追跡容易 |
| 失敗からのリカバリー | 旧設計に固執 | 一時対応のみ | 再設計して復旧 | 改善を標準化している |

## 失敗時のリカバリー手順

1. 変更要求を「目的変更」か「制約変更」かに分類する
2. 設計全体を直さず、影響モジュールを先に特定する
3. 差し替え後の整合性を上流から下流へ検証する
4. 変更理由と採用判断を `design-change-log.md` に残す

## 次章への接続

最終ゲート章で、成果物の再現性と評価基準を満たしているかを判定します。

---

## 課題提出

この章には提出課題があります。

1. 上記の[練習問題/ハンズオン課題/制作物]を完了する
2. GitHub で `feature/[章ファイル名（拡張子なし）]` ブランチを作成し、`develop` へのPRを作成（base=`develop`）
3. [AI総合レビューツール](https://ai.studio/apps/drive/1AMqIqU4Bio4te7AWh5dly1Qzp7CesqP9?fullscreenApplet=true) でレビューを実行
4. 問題がなければ、スプレッドシートに **PR URL** と **完了日** を記入
